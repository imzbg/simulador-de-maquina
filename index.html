<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simulador de Máquina — Teoria da Computação (Genérico)</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <div class="hero">
      <h1>Simulador de Máquina — Teoria da Computação</h1>
      <p>
        Versão com registradores <strong>R1..Rn</strong>, memória <strong>M0..Mm</strong>
        e filas de entrada/saída. Ajuste as funções permitidas por registrador,
        escreva o programa e acompanhe a execução passo a passo.
      </p>
    </div>
  </header>

  <main>
    <div class="layout">
      <div class="content-flow">
        <section class="panel" id="machine-def">
          <h2>1) Definição da Máquina</h2>
          <div class="row">
            <div class="col">
              <label>Memória (células) 1-16
                <input type="number" id="mem-count" min="1" max="16" value="8" />
              </label>
              <label>Entradas (fila) 1-16
                <input type="number" id="in-count" min="1" max="16" value="4" />
              </label>
              <label>Saídas (fila) 1-16
                <input type="number" id="out-count" min="1" max="16" value="4" />
              </label>
              <label>Registradores (1-16)
                <input type="number" id="reg-count" min="1" max="16" value="5" />
              </label>
              <div class="buttons">
                <button id="apply-machine">Aplicar Máquina</button>
                <button id="export-machine">Gerar Máquina (texto)</button>
                <button id="save-machine">Gravar Máquina (local)</button>
                <button id="load-machine">Carregar Máquina (local)</button>
              </div>
            </div>
            <div class="col" id="reg-config-area">
              <h3>Configuração por Registrador</h3>
              <div id="reg-list"></div>
            </div>
          </div>
          <pre id="machine-text" class="output"></pre>
        </section>

        <section class="panel" id="program-def">
          <h2>2) Definição do Programa</h2>
          <p class="helper-text">
            Formato (rotulado): <code>label: OP args</code> — Ex:
            <code>inicio: IN R1</code> ou <code>loop: JZ R2 fim</code>
          </p>
          <textarea id="program-code" rows="12" placeholder="Exemplo:
inicio: IN R1
loop: LOAD M0 R2
ADD R1 R2
STORE R2 M0
OUT R2
DEC R1
JNZ R1 loop
HALT"></textarea>
          <div class="buttons">
            <button id="validate-program">Validar Programa</button>
            <button id="save-program">Gravar Programa</button>
            <button id="export-program">Gerar Programa (texto)</button>
            <button id="load-program">Carregar Programa</button>
          </div>
          <pre id="program-validate" class="output"></pre>
        </section>

        <section class="panel" id="execution">
          <h2>3) Execução / Computação</h2>
          <div class="row">
            <div class="col">
              <h3>Entradas (fila)</h3>
              <div id="inputs-area"></div>
              <h3>Controles</h3>
              <div class="buttons">
                <button id="reset">Reset</button>
                <button id="step">Step</button>
                <button id="run">Run</button>
                <button id="stop">Stop</button>
                <label>Delay (ms)
                  <input id="run-delay" type="number" value="300" min="0" />
                </label>
                <button id="export-log">Exportar Log</button>
              </div>
            </div>
            <div class="col">
              <h3>Registradores e Memória</h3>
              <div id="regs-area" class="state-grid"></div>
              <div id="mem-area" class="state-grid"></div>
              <h3>Saídas (fila)</h3>
              <div id="outputs-area"></div>
            </div>
          </div>

          <h3>Trace / Função Computada</h3>
          <pre id="trace" class="output trace"></pre>
        </section>
      </div>
      <aside class="side-help">
        <div class="side-card guide-card">
          <h2>Guia rápido</h2>
          <ol class="step-list">
            <li>
              <a href="#machine-def">Configurar máquina</a>
              <p>Escolha tamanhos, defina registradores e ajuste permissões por registrador.</p>
            </li>
            <li>
              <a href="#program-def">Escrever programa</a>
              <p>Use rótulos curtos e valide sempre que alterar as instruções.</p>
            </li>
            <li>
              <a href="#execution">Executar e observar</a>
              <p>Preencha as filas de entrada, use <strong>Step</strong> para depurar e <strong>Run</strong> para rodar.</p>
            </li>
          </ol>
          <div class="quick-hint">
            <strong>Dica:</strong> Salve máquina e programa localmente para continuar depois.
          </div>
        </div>

        <div class="side-card instructions-card">
          <h2>Instruções Suportadas</h2>
          <ul class="instruction-list">
            <li><code>IN Rn</code> — lê o próximo valor da fila de entrada para Rn</li>
            <li><code>OUT Rn</code> — envia Rn para a fila de saída</li>
            <li><code>MOV Rsrc Rdst</code> — copia valor entre registradores</li>
            <li><code>LOAD Mx Rn</code> / <code>STORE Rn Mx</code> — troca valores com a memória</li>
            <li><code>INC</code> / <code>DEC</code> — incrementa ou decrementa o registrador</li>
            <li><code>ADD</code> / <code>SUB</code> — soma/subtrai Rsrc em Rdst</li>
            <li><code>JUMP</code>, <code>JZ</code>, <code>JNZ</code> — desvios por rótulo</li>
            <li><code>HALT</code> — encerra a computação</li>
          </ul>
          <p class="helper-text">
            Ajuste a aba “Configuração por Registrador” para liberar apenas as operações que cada registrador pode usar.
          </p>
        </div>
      </aside>
    </div>
  </main>

  <script src="app.js"></script>
</body>
</html>
